<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê°€ìœ„ë°”ìœ„ë³´ ì¿ í° ì´ë²¤íŠ¸</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background:#f6f7f9; }
    .wrap { max-width: 760px; margin: 0 auto; padding: 20px; }
    .card { background:#fff; border-radius:18px; padding:20px; box-shadow: 0 10px 24px rgba(0,0,0,.07); }
    h1 { font-size: 22px; margin: 0 0 8px; }
    .sub { color:#555; margin: 0 0 14px; font-size: 14px; line-height: 1.5; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef; color:#224; font-size:12px; }

    /* Arena */
    .arena{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:24px;
      margin-top:18px;
      padding-top:6px;
    }
    .player{ text-align:center; flex:1; }
    .handCircle{
      width:140px; height:140px;
      border-radius:999px;
      margin:0 auto;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 16px 28px rgba(0,0,0,.10);
    }
    .handCircle svg{ width:92px; height:92px; }
    .handCircle.computer{ background:#3b82f6; }
    .handCircle.guest{ background:#ef4444; }
    .playerLabel{ margin-top:10px; font-size:14px; color:#555; font-weight:800; }

    .chooseText{
      text-align:center;
      margin-top:16px;
      color:#666;
      font-weight:800;
    }

    /* Picks */
    .pickRow{
      display:flex;
      justify-content:center;
      gap:18px;
      margin-top:14px;
      flex-wrap:wrap;
    }
    .pick{
      width:78px; height:78px;
      border-radius:999px;
      border:0;
      background:#f2f4f7;
      box-shadow: 0 10px 20px rgba(0,0,0,.07);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .pick svg{ width:48px; height:48px; }
    .pick:active{ transform: scale(.98); }
    .pick:disabled{ opacity:.55; cursor:not-allowed; }

    /* Control buttons */
    .controls{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:14px;
      flex-wrap:wrap;
    }
    .ctrlBtn{
      border:0;
      border-radius:999px;
      padding:12px 16px;
      font-size:15px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,.07);
    }
    .ctrlBtn:disabled{ opacity:.5; cursor:not-allowed; }
    .startBtn{ background:#111; color:#fff; }
    .stopBtn{ background:#1a73e8; color:#fff; }
    .retryBtn{ background:#6b7280; color:#fff; }

    /* Result */
    .result { margin-top: 16px; font-size: 18px; font-weight: 900; text-align:center; }
    .win { color:#1e8e3e; }
    .draw { color:#1a73e8; }
    .lose { color:#666; }

    /* QR */
    .qrWrap { margin-top: 14px; display:none; }
    .qrCard { background:#fff; border-radius:16px; padding:16px; border:1px solid #e6e8ee; }
    .couponLine { margin-top:10px; font-size:14px; color:#333; word-break: break-all; text-align:center; }
    .small { font-size:12px; color:#777; margin-top:8px; line-height:1.4; text-align:center; }

    .hint { margin-top: 12px; font-size: 13px; color:#666; line-height:1.5; }
    .footer { margin-top: 14px; font-size: 12px; color:#888; text-align:center; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>ê°€ìœ„ë°”ìœ„ë³´ í•œ íŒ ğŸ®</h1>
      <p class="sub">
        ì•„ë˜ì—ì„œ ê°€ìœ„/ë°”ìœ„/ë³´ë¥¼ ì„ íƒí•˜ë©´ <b>ì»´í“¨í„°ê°€ ë¡¤ë§</b>ì„ ì‹œì‘í•©ë‹ˆë‹¤.<br/>
        ì›í•˜ëŠ” íƒ€ì´ë°ì— <b>ë©ˆì¶”ê¸°</b>ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ í™•ì •í•˜ê³ , <b>ì¿ í° QR</b>ì„ ë°›ìœ¼ì„¸ìš”.
        <br/><span class="pill">ë¬´ë£Œ ìš´ì˜</span>
      </p>

      <!-- Arena -->
      <div class="arena">
        <div class="player">
          <div class="handCircle computer" id="cpuCircle">
            <div id="cpuHand"></div>
          </div>
          <div class="playerLabel">ì»´í“¨í„°</div>
        </div>

        <div class="player">
          <div class="handCircle guest" id="meCircle">
            <div id="meHand"></div>
          </div>
          <div class="playerLabel">Guest</div>
        </div>
      </div>

      <div class="chooseText" id="chooseText">ê°€ìœ„ë°”ìœ„ë³´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</div>

      <!-- Picks -->
      <div class="pickRow">
        <button class="pick" id="pickScissors" onclick="choose('scissors')" aria-label="ê°€ìœ„">
          <span id="iconScissors"></span>
        </button>
        <button class="pick" id="pickRock" onclick="choose('rock')" aria-label="ë°”ìœ„">
          <span id="iconRock"></span>
        </button>
        <button class="pick" id="pickPaper" onclick="choose('paper')" aria-label="ë³´">
          <span id="iconPaper"></span>
        </button>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="ctrlBtn startBtn" id="startBtn" onclick="startRolling()" disabled>ë¡¤ë§ ì‹œì‘</button>
        <button class="ctrlBtn stopBtn" id="stopBtn" onclick="stopRolling()" disabled>ë©ˆì¶”ê¸°</button>
        <button class="ctrlBtn retryBtn" id="retryBtn" onclick="resetGame()" disabled>ë‹¤ì‹œí•˜ê¸°</button>
      </div>

      <div class="result" id="result">ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.</div>

      <div class="qrWrap" id="qrWrap">
        <div class="qrCard">
          <div style="display:flex; justify-content:center;">
            <div id="qrcode"></div>
          </div>
          <div class="couponLine"><b>ì¿ í° ë‚´ìš©:</b> <span id="couponText">-</span></div>
          <div class="small" id="couponRule">* QRì„ ê³„ì‚°ëŒ€ì—ì„œ ì œì‹œí•´ ì£¼ì„¸ìš”. (1íšŒ ì‚¬ìš© / ë‹¹ì¼ ìœ íš¨)</div>
        </div>
      </div>

      <div class="hint">
        ìš´ì˜ íŒ(ë¬´ë£Œ ìš´ì˜ ê¸°ì¤€):<br/>
        - â€œê½ ì—†ìŒ(ìµœì†Œ í˜œíƒ ë³´ì¥)â€ì´ ë°©ë¬¸ ì „í™˜ì— ìœ ë¦¬í•©ë‹ˆë‹¤.<br/>
        - QR ë‚´ìš©ì—ëŠ” <b>ì¿ í°ì¢…ë¥˜ + ë‚ ì§œ + ë‚œìˆ˜</b>ê°€ í¬í•¨ë˜ì–´ í˜„ì¥ í†µì œê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤.
      </div>

      <div class="footer">Â© Event Mini Game</div>
    </div>
  </div>

  <!-- QRCode.js -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <script>
    // ====== ê³ ê¸‰ìŠ¤ëŸ¬ìš´ SVG ì•„ì´ì½˜(íŒŒì¼ ì—…ë¡œë“œ ë¶ˆí•„ìš”) ======
    function svgHand(type){
      // ë‹¨ìˆœí•˜ì§€ë§Œ ì„ ëª…í•œ â€œì¼ëŸ¬ìŠ¤íŠ¸ ëŠë‚Œâ€ SVG (í°ìƒ‰ ì† + ì™¸ê³½ì„ )
      const common = 'fill="#ffffff" stroke="#111827" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"';
      if(type === 'scissors'){
        return `
          <svg viewBox="0 0 256 256" aria-hidden="true">
            <path ${common} d="M86 190c18 10 44 6 58-12l12-16 12 16c14 18 40 22 58 12 18-10 24-34 14-52-8-14-24-22-40-20-8 1-16 5-22 11l-22 24-22-24c-6-6-14-10-22-11-16-2-32 6-40 20-10 18-4 42 14 52z"/>
            <path ${common} d="M110 78l34 70"/>
            <path ${common} d="M146 78l-34 70"/>
          </svg>`;
      }
      if(type === 'rock'){
        return `
          <svg viewBox="0 0 256 256" aria-hidden="true">
            <path ${common} d="M78 128c0-24 16-44 40-44h46c22 0 36 18 36 40v22c0 28-20 50-50 50h-22c-28 0-50-20-50-50z"/>
            <path ${common} d="M102 92v-6c0-14 10-24 24-24"/>
            <path ${common} d="M140 92v-8c0-14 10-24 24-24"/>
            <path ${common} d="M118 92v-10c0-14 10-24 24-24"/>
          </svg>`;
      }
      // paper
      return `
        <svg viewBox="0 0 256 256" aria-hidden="true">
          <path ${common} d="M92 74c0-14 10-24 24-24h24c14 0 24 10 24 24v108c0 14-10 24-24 24h-24c-14 0-24-10-24-24z"/>
          <path ${common} d="M108 96h40M108 126h40M108 156h40"/>
        </svg>`;
    }

    // ì•„ì´ì½˜ ì‚½ì…
    document.getElementById('iconScissors').innerHTML = svgHand('scissors');
    document.getElementById('iconRock').innerHTML = svgHand('rock');
    document.getElementById('iconPaper').innerHTML = svgHand('paper');

    // ì´ˆê¸° í° ì†
    document.getElementById('cpuHand').innerHTML = svgHand('paper');
    document.getElementById('meHand').innerHTML = svgHand('scissors');

    // ====== ê²Œì„ ë¡œì§(Stop ë²„íŠ¼ìœ¼ë¡œ ë©ˆì¶”ê¸°) ======
    const choices = ['scissors','rock','paper'];

    function labelOf(v){
      return v === 'scissors' ? 'ê°€ìœ„' : (v === 'rock' ? 'ë°”ìœ„' : 'ë³´');
    }

    // ì¿ í° ì •ì±…(ì›í•˜ì‹œë©´ ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤)
    const couponByOutcome = {
      WIN:  { name: 'ìŒë£Œ 1ì” êµí™˜ê¶Œ',     code: 'DRINK1' },
      DRAW: { name: 'ì‚¬ì´ë“œ 1ì¢… 50% í• ì¸', code: 'SIDE50' },
      LOSE: { name: '5% í• ì¸ ì¿ í°',        code: 'DISC5' }
    };

    function buildQrPayload(couponCode){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const dateStr = `${yyyy}-${mm}-${dd}`;
      const rand = Math.random().toString(16).slice(2, 8).toUpperCase();
      return `INSPIRE|${couponCode}|${dateStr}|${rand}`;
    }

    function judge(me, cpu){
      if(me === cpu) return 'DRAW';
      if(
        (me==='scissors' && cpu==='paper') ||
        (me==='rock' && cpu==='scissors') ||
        (me==='paper' && cpu==='rock')
      ) return 'WIN';
      return 'LOSE';
    }

    // ìƒíƒœ
    let selectedMe = null;
    let rollingTimer = null;
    let rollingValue = 'paper'; // ë¡¤ë§ ì¤‘ í˜„ì¬ ê°’

    const el = {
      meHand: document.getElementById('meHand'),
      cpuHand: document.getElementById('cpuHand'),
      chooseText: document.getElementById('chooseText'),
      result: document.getElementById('result'),
      startBtn: document.getElementById('startBtn'),
      stopBtn: document.getElementById('stopBtn'),
      retryBtn: document.getElementById('retryBtn'),
      qrWrap: document.getElementById('qrWrap'),
      qrcode: document.getElementById('qrcode'),
      couponText: document.getElementById('couponText')
    };

    function setPickDisabled(disabled){
      document.querySelectorAll('.pick').forEach(b => b.disabled = disabled);
    }

    function choose(me){
      if(rollingTimer) return; // ë¡¤ë§ ì¤‘ì—ëŠ” ì„ íƒ ë³€ê²½ ë¶ˆê°€
      selectedMe = me;

      el.meHand.innerHTML = svgHand(me);
      el.chooseText.textContent = `ë‹¹ì‹ ì˜ ì„ íƒì€ â€˜${labelOf(me)}â€™ì…ë‹ˆë‹¤. ë¡¤ë§ì„ ì‹œì‘í•˜ì„¸ìš”.`;
      el.result.className = 'result';
      el.result.textContent = 'ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.';

      el.startBtn.disabled = false;
      el.stopBtn.disabled = true;
      el.retryBtn.disabled = false;

      // QR ì´ˆê¸°í™”
      el.qrWrap.style.display = 'none';
      el.qrcode.innerHTML = '';
      el.couponText.textContent = '-';
    }

    function startRolling(){
      if(!selectedMe || rollingTimer) return;

      // ë²„íŠ¼/ì„ íƒ ì ê¸ˆ
      setPickDisabled(true);
      el.startBtn.disabled = true;
      el.stopBtn.disabled = false;

      el.result.className = 'result';
      el.result.textContent = 'ì»´í“¨í„°ê°€ ê³ ë¥´ëŠ” ì¤‘â€¦ ì›í•˜ëŠ” íƒ€ì´ë°ì— ë©ˆì¶”ê¸°!';

      // ë¡¤ë§ ì‹œì‘
      let idx = 0;
      rollingTimer = setInterval(() => {
        rollingValue = choices[idx % 3];
        el.cpuHand.innerHTML = svgHand(rollingValue);
        idx++;
      }, 110);
    }

    function stopRolling(){
      if(!rollingTimer) return;

      clearInterval(rollingTimer);
      rollingTimer = null;

      const cpu = rollingValue; // ë©ˆì¶˜ ìˆœê°„ì˜ ê°’ì´ ì»´í“¨í„° ì„ íƒ
      el.cpuHand.innerHTML = svgHand(cpu);

      const outcome = judge(selectedMe, cpu);
      const cpn = couponByOutcome[outcome];

      el.result.className = 'result';
      if(outcome === 'WIN') el.result.classList.add('win');
      if(outcome === 'DRAW') el.result.classList.add('draw');
      if(outcome === 'LOSE') el.result.classList.add('lose');

      const text =
        outcome === 'WIN' ? 'ğŸ‰ ìŠ¹ë¦¬! ì¶•í•˜ë“œë¦½ë‹ˆë‹¤' :
        outcome === 'DRAW' ? 'ğŸ˜„ ë¬´ìŠ¹ë¶€! í˜œíƒì„ ë“œë ¤ìš”' :
        'ğŸ˜‰ ì•„ì‰½ì§€ë§Œ ì°¸ì—¬ ê°ì‚¬í•©ë‹ˆë‹¤!';

      el.result.textContent = `${text} (Guest: ${labelOf(selectedMe)} / ì»´í“¨í„°: ${labelOf(cpu)}) â†’ ${cpn.name}`;

      // QR ìƒì„±(ë“±ì¥ ì—°ì¶œ)
      setTimeout(() => {
        const payload = buildQrPayload(cpn.code);
        el.couponText.textContent = payload;
        el.qrWrap.style.display = 'block';
        el.qrcode.innerHTML = '';
        new QRCode(el.qrcode, { text: payload, width: 200, height: 200 });
      }, 350);

      // ë²„íŠ¼ ìƒíƒœ
      el.stopBtn.disabled = true;
      el.retryBtn.disabled = false;

      // ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ í•´ì œ(ì›í•˜ì‹œë©´ "ë‹¤ì‹œí•˜ê¸°"ë¥¼ ëˆŒëŸ¬ì•¼ë§Œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ ë°”ê¿€ ìˆ˜ë„ ìˆìŒ)
      setPickDisabled(false);
    }

    function resetGame(){
      if(rollingTimer){
        clearInterval(rollingTimer);
        rollingTimer = null;
      }
      selectedMe = null;

      el.meHand.innerHTML = svgHand('scissors');
      el.cpuHand.innerHTML = svgHand('paper');

      el.chooseText.textContent = 'ê°€ìœ„ë°”ìœ„ë³´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”';
      el.result.className = 'result';
      el.result.textContent = 'ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.';

      el.startBtn.disabled = true;
      el.stopBtn.disabled = true;
      el.retryBtn.disabled = true;

      setPickDisabled(false);

      el.qrWrap.style.display = 'none';
      el.qrcode.innerHTML = '';
      el.couponText.textContent = '-';
    }
  </script>
</body>
</html>
