<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê°€ìœ„ë°”ìœ„ë³´ ì¿ í° ì´ë²¤íŠ¸</title>
  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.10);
      --text:#e8eefc;
      --muted: rgba(232,238,252,.7);
      --blue:#3b82f6;
      --red:#ef4444;
      --win:#22c55e;
      --draw:#60a5fa;
      --lose:#94a3b8;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(59,130,246,.25), transparent 60%),
                  radial-gradient(1000px 600px at 80% 20%, rgba(239,68,68,.20), transparent 55%),
                  radial-gradient(900px 600px at 50% 100%, rgba(34,197,94,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }
    .wrap{ max-width:900px; margin:0 auto; padding:22px; }
    .title{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:14px;
    }
    h1{ margin:0; font-size:22px; letter-spacing:.2px; }
    .sub{ margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.5; }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.10); font-size:12px; color:var(--text); }

    .board{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }

    /* Arena */
    .arena{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap:14px;
      margin-top:10px;
    }
    .vs{
      font-weight:900;
      color:rgba(232,238,252,.55);
      letter-spacing:2px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }

    .slot{
      display:flex; flex-direction:column; align-items:center; gap:10px;
      padding:14px;
      border-radius:18px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
    }
    .slotHead{
      display:flex; gap:10px; align-items:center;
      color:rgba(232,238,252,.85);
      font-size:14px; font-weight:800;
    }
    .dot{ width:10px; height:10px; border-radius:999px; }
    .dot.blue{ background: var(--blue); box-shadow: 0 0 20px rgba(59,130,246,.6); }
    .dot.red{ background: var(--red); box-shadow: 0 0 20px rgba(239,68,68,.55); }

    .handFrame{
      width:190px; height:190px;
      border-radius:22px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      display:flex; align-items:center; justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .handFrame::after{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.22), transparent 40%);
      transform: rotate(12deg);
      pointer-events:none;
    }

    .handImg{
      width:150px; height:150px; object-fit:contain;
      filter: drop-shadow(0 18px 24px rgba(0,0,0,.35));
      transform-origin: 50% 70%;
    }

    /* Rolling realism */
    .rolling .handImg{
      animation: shake .12s infinite linear;
      filter: drop-shadow(0 18px 24px rgba(0,0,0,.35)) blur(.25px);
    }
    @keyframes shake{
      0%{ transform: translateX(-2px) rotate(-6deg) scale(1.01); }
      50%{ transform: translateX(2px) rotate(6deg) scale(1.02); }
      100%{ transform: translateX(-2px) rotate(-6deg) scale(1.01); }
    }
    .snap{
      animation: snap .18s ease-out;
    }
    @keyframes snap{
      0%{ transform: scale(.92); }
      60%{ transform: scale(1.03); }
      100%{ transform: scale(1); }
    }

    /* Choose area */
    .chooseText{
      text-align:center;
      margin:14px 0 10px;
      color:rgba(232,238,252,.75);
      font-weight:800;
    }
    .pickRow{
      display:flex;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .pick{
      width:92px; height:92px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .pick:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); }
    .pick:active{ transform: translateY(0px) scale(.98); }
    .pick:disabled{ opacity:.5; cursor:not-allowed; }
    .pick img{ width:60px; height:60px; object-fit:contain; filter: drop-shadow(0 10px 16px rgba(0,0,0,.28)); }

    /* Controls */
    .controls{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .btn{
      border:0;
      border-radius:999px;
      padding:12px 16px;
      font-size:15px;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 14px 30px rgba(0,0,0,.30);
      transition: transform .12s ease, opacity .12s ease;
    }
    .btn:active{ transform: scale(.98); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; box-shadow:none; }
    .btnStop{ background: linear-gradient(180deg, #60a5fa, #1d4ed8); color:white; }
    .btnRetry{ background: rgba(255,255,255,.10); color: var(--text); border:1px solid rgba(255,255,255,.14); }

    /* Result */
    .result{
      margin-top:14px;
      text-align:center;
      font-size:18px;
      font-weight:1000;
      letter-spacing:.1px;
    }
    .result.win{ color: var(--win); text-shadow: 0 0 18px rgba(34,197,94,.35); }
    .result.draw{ color: var(--draw); text-shadow: 0 0 18px rgba(96,165,250,.35); }
    .result.lose{ color: var(--lose); }

    /* Flash effect on stop */
    .flash{
      position:fixed; inset:0;
      background: rgba(255,255,255,.12);
      opacity:0;
      pointer-events:none;
    }
    .flash.on{ animation: flash .16s ease-out; }
    @keyframes flash{
      0%{ opacity:.0; }
      30%{ opacity:.28; }
      100%{ opacity:0; }
    }

    /* QR */
    .qrWrap{ margin-top:14px; display:none; }
    .qrCard{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      padding:14px;
      text-align:center;
    }
    .couponLine{ margin-top:10px; font-size:14px; color:rgba(232,238,252,.9); word-break:break-all; }
    .small{ margin-top:8px; font-size:12px; color:rgba(232,238,252,.65); line-height:1.5; }

    .hint{ margin-top:12px; font-size:12px; color:rgba(232,238,252,.55); line-height:1.5; text-align:center; }
  </style>
</head>
<body>
  <div class="flash" id="flash"></div>

  <div class="wrap">
    <div class="title">
      <div>
        <h1>ê°€ìœ„ë°”ìœ„ë³´ í•œ íŒ ğŸ®</h1>
        <div class="sub">Guestê°€ ì„ íƒí•˜ë©´ ì»´í“¨í„°ê°€ <b>ë¡¤ë§</b>ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì›í•˜ëŠ” ìˆœê°„ <b>ë©ˆì¶”ê¸°</b>ë¡œ í™•ì •í•˜ê³  ì¿ í° QRì„ ë°›ìœ¼ì„¸ìš”.</div>
      </div>
      <div class="pill">Realistic Mode</div>
    </div>

    <div class="board">
      <div class="arena">
        <div class="slot" id="cpuSlot">
          <div class="slotHead"><span class="dot blue"></span>ì»´í“¨í„°</div>
          <div class="handFrame">
            <img id="cpuImg" class="handImg" src="assets/paper.png" alt="ì»´í“¨í„°" />
          </div>
        </div>

        <div class="vs">VS</div>

        <div class="slot" id="meSlot">
          <div class="slotHead"><span class="dot red"></span>Guest</div>
          <div class="handFrame">
            <img id="meImg" class="handImg" src="assets/scissors.png" alt="Guest" />
          </div>
        </div>
      </div>

      <div class="chooseText" id="chooseText">ê°€ìœ„ë°”ìœ„ë³´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</div>

      <div class="pickRow">
        <button class="pick" id="pickScissors" onclick="choose('scissors')" aria-label="ê°€ìœ„">
          <img src="assets/scissors.png" alt="ê°€ìœ„" />
        </button>
        <button class="pick" id="pickRock" onclick="choose('rock')" aria-label="ë°”ìœ„">
          <img src="assets/rock.png" alt="ë°”ìœ„" />
        </button>
        <button class="pick" id="pickPaper" onclick="choose('paper')" aria-label="ë³´">
          <img src="assets/paper.png" alt="ë³´" />
        </button>
      </div>

      <div class="controls">
        <button class="btn btnStop" id="stopBtn" onclick="stopRolling()" disabled>ë©ˆì¶”ê¸°</button>
        <button class="btn btnRetry" id="retryBtn" onclick="resetGame()" disabled>ë‹¤ì‹œí•˜ê¸°</button>
      </div>

      <div class="result" id="result">ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.</div>

      <div class="qrWrap" id="qrWrap">
        <div class="qrCard">
          <div style="display:flex; justify-content:center;">
            <div id="qrcode"></div>
          </div>
          <div class="couponLine"><b>ì¿ í° ë‚´ìš©:</b> <span id="couponText">-</span></div>
          <div class="small" id="couponRule">* QRì„ ê³„ì‚°ëŒ€ì—ì„œ ì œì‹œí•´ ì£¼ì„¸ìš”. (1íšŒ ì‚¬ìš© / ë‹¹ì¼ ìœ íš¨)</div>
        </div>
      </div>

      <div class="hint">
        ìš´ì˜ íŒ: â€œê½ ì—†ìŒ(ìµœì†Œ í˜œíƒ ë³´ì¥)â€ì´ ë°©ë¬¸ ì „í™˜ìœ¨ì´ ì¢‹ìŠµë‹ˆë‹¤. / QRì—ëŠ” ì¿ í°ì½”ë“œÂ·ë‚ ì§œÂ·ë‚œìˆ˜ê°€ í¬í•¨ë©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script>
    // ---- Audio (ë¬´ìŒ í—ˆìš©, ìë™ì¬ìƒ ì œí•œ ëŒ€ì‘) ----
    const audioCtx = (window.AudioContext || window.webkitAudioContext) ? new (window.AudioContext || window.webkitAudioContext)() : null;

    function beep(freq=440, dur=0.05, type='square', gain=0.03){
      if(!audioCtx) return;
      try{
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type;
        o.frequency.value = freq;
        g.gain.value = gain;
        o.connect(g);
        g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + dur);
      }catch(e){}
    }

    function haptic(ms=20){
      if(navigator.vibrate) navigator.vibrate(ms);
    }

    const choices = ['scissors','rock','paper'];
    const imgOf = (v) => v === 'scissors' ? 'assets/scissors.png' : (v === 'rock' ? 'assets/rock.png' : 'assets/paper.png');
    const labelOf = (v) => v === 'scissors' ? 'ê°€ìœ„' : (v === 'rock' ? 'ë°”ìœ„' : 'ë³´');

    // ì¿ í° ì •ì±…
    const couponByOutcome = {
      WIN:  { name: 'ìŒë£Œ 1ì” êµí™˜ê¶Œ',     code: 'DRINK1' },
      DRAW: { name: 'ì‚¬ì´ë“œ 1ì¢… 50% í• ì¸', code: 'SIDE50' },
      LOSE: { name: '5% í• ì¸ ì¿ í°',        code: 'DISC5' }
    };

    function buildQrPayload(couponCode){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const dateStr = `${yyyy}-${mm}-${dd}`;
      const rand = Math.random().toString(16).slice(2, 8).toUpperCase();
      return `INSPIRE|${couponCode}|${dateStr}|${rand}`;
    }

    function judge(me, cpu){
      if(me === cpu) return 'DRAW';
      if(
        (me==='scissors' && cpu==='paper') ||
        (me==='rock' && cpu==='scissors') ||
        (me==='paper' && cpu==='rock')
      ) return 'WIN';
      return 'LOSE';
    }

    const el = {
      cpuSlot: document.getElementById('cpuSlot'),
      meSlot: document.getElementById('meSlot'),
      cpuImg: document.getElementById('cpuImg'),
      meImg: document.getElementById('meImg'),
      chooseText: document.getElementById('chooseText'),
      stopBtn: document.getElementById('stopBtn'),
      retryBtn: document.getElementById('retryBtn'),
      result: document.getElementById('result'),
      qrWrap: document.getElementById('qrWrap'),
      qrcode: document.getElementById('qrcode'),
      couponText: document.getElementById('couponText'),
      flash: document.getElementById('flash')
    };

    function setPickDisabled(disabled){
      document.querySelectorAll('.pick').forEach(b => b.disabled = disabled);
    }

    // State
    let selectedMe = null;
    let rollingTimer = null;
    let rollingValue = 'paper';

    function clearQR(){
      el.qrWrap.style.display = 'none';
      el.qrcode.innerHTML = '';
      el.couponText.textContent = '-';
    }

    function choose(me){
      if(rollingTimer) return;
      selectedMe = me;

      // Guest hand snap
      el.meImg.src = imgOf(me);
      el.meImg.classList.remove('snap'); void el.meImg.offsetWidth; el.meImg.classList.add('snap');

      el.chooseText.textContent = `ë‹¹ì‹ ì˜ ì„ íƒì€ â€˜${labelOf(me)}â€™ì…ë‹ˆë‹¤. (ì´ì œ ì»´í“¨í„°ê°€ ë¡¤ë§í•©ë‹ˆë‹¤)`;
      el.result.className = 'result';
      el.result.textContent = 'ë©ˆì¶”ê¸°ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ í™•ì •í•˜ì„¸ìš”.';

      clearQR();
      el.retryBtn.disabled = false;

      // Rolling starts immediately (í•µì‹¬)
      startRolling();
    }

    function startRolling(){
      if(!selectedMe || rollingTimer) return;

      setPickDisabled(true);
      el.stopBtn.disabled = false;

      el.cpuSlot.classList.add('rolling');

      let idx = 0;
      rollingTimer = setInterval(() => {
        rollingValue = choices[idx % 3];
        el.cpuImg.src = imgOf(rollingValue);

        // ë¡¤ë§ ì‚¬ìš´ë“œ(ê°€ë³ê²Œ)
        if(idx % 2 === 0) beep(520, 0.03, 'square', 0.02);
        idx++;
      }, 90);
    }

    function stopRolling(){
      if(!rollingTimer) return;

      clearInterval(rollingTimer);
      rollingTimer = null;

      // Flash + haptic + snap
      el.flash.classList.remove('on'); void el.flash.offsetWidth; el.flash.classList.add('on');
      haptic(25);
      beep(220, 0.06, 'sine', 0.05);

      el.cpuSlot.classList.remove('rolling');

      const cpu = rollingValue; // ë©ˆì¶˜ ìˆœê°„ ê°’
      el.cpuImg.src = imgOf(cpu);
      el.cpuImg.classList.remove('snap'); void el.cpuImg.offsetWidth; el.cpuImg.classList.add('snap');

      const outcome = judge(selectedMe, cpu);
      const cpn = couponByOutcome[outcome];

      el.result.className = 'result ' + (outcome === 'WIN' ? 'win' : outcome === 'DRAW' ? 'draw' : 'lose');

      const text =
        outcome === 'WIN' ? 'ğŸ‰ ìŠ¹ë¦¬!' :
        outcome === 'DRAW' ? 'ğŸ˜„ ë¬´ìŠ¹ë¶€!' :
        'ğŸ˜‰ ì°¸ì—¬ ê°ì‚¬í•©ë‹ˆë‹¤!';

      el.result.textContent = `${text} (Guest: ${labelOf(selectedMe)} / ì»´í“¨í„°: ${labelOf(cpu)}) â†’ ${cpn.name}`;

      // QR ë“±ì¥ ì—°ì¶œ
      setTimeout(() => {
        const payload = buildQrPayload(cpn.code);
        el.couponText.textContent = payload;
        el.qrWrap.style.display = 'block';
        el.qrcode.innerHTML = '';
        new QRCode(el.qrcode, { text: payload, width: 200, height: 200 });
      }, 420);

      el.stopBtn.disabled = true;
      el.retryBtn.disabled = false;
      setPickDisabled(false);
    }

    function resetGame(){
      if(rollingTimer){
        clearInterval(rollingTimer);
        rollingTimer = null;
      }
      selectedMe = null;
      rollingValue = 'paper';

      el.cpuSlot.classList.remove('rolling');

      el.cpuImg.src = imgOf('paper');
      el.meImg.src = imgOf('scissors');

      el.chooseText.textContent = 'ê°€ìœ„ë°”ìœ„ë³´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”';
      el.result.className = 'result';
      el.result.textContent = 'ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.';

      clearQR();

      el.stopBtn.disabled = true;
      el.retryBtn.disabled = true;
      setPickDisabled(false);
    }
  </script>
</body>
</html>
